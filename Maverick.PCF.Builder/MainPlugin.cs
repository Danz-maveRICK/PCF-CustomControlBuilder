using System;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Collections.Generic;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace Maverick.PCF.Builder
{
    // Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class
    // To generate Base64 string for Images below, you can use https://www.base64-image.de/
    [Export(typeof(IXrmToolBoxPlugin)),
        ExportMetadata("Name", "PCF Custom Control Builder"),
        ExportMetadata("Description", "Easily create, build and deployment solution for your custom control using PCF."),
        // Please specify the base64 content of a 32x32 pixels image
        ExportMetadata("SmallImageBase64", "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"),
        // Please specify the base64 content of a 80x80 pixels image
        ExportMetadata("BigImageBase64", "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"),
        ExportMetadata("BackgroundColor", "#32254A"),
        ExportMetadata("PrimaryFontColor", "White"),
        ExportMetadata("SecondaryFontColor", "Gray")]
    public class MainPlugin : PluginBase
    {
        public override IXrmToolBoxPluginControl GetControl()
        {
            return new MainPluginControl();
        }

        /// <summary>
        /// Constructor 
        /// </summary>
        public MainPlugin()
        {
            // If you have external assemblies that you need to load, uncomment the following to 
            // hook into the event that will fire when an Assembly fails to resolve
            // AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(AssemblyResolveEventHandler);
        }

        /// <summary>
        /// Event fired by CLR when an assembly reference fails to load
        /// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
        /// For example, a folder named Sample.XrmToolBox.MyPlugin 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="args"></param>
        /// <returns></returns>
        private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
        {
            Assembly loadAssembly = null;
            Assembly currAssembly = Assembly.GetExecutingAssembly();

            // base name of the assembly that failed to resolve
            var argName = args.Name.Substring(0, args.Name.IndexOf(","));

            // check to see if the failing assembly is one that we reference.
            List<AssemblyName> refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
            var refAssembly = refAssemblies.Where(a => a.Name == argName).FirstOrDefault();

            // if the current unresolved assembly is referenced by our plugin, attempt to load
            if (refAssembly != null)
            {
                // load from the path to this plugin assembly, not host executable
                string dir = Path.GetDirectoryName(currAssembly.Location).ToLower();
                string folder = Path.GetFileNameWithoutExtension(currAssembly.Location);
                dir = Path.Combine(dir, folder);

                var assmbPath = Path.Combine(dir, $"{argName}.dll");

                if (File.Exists(assmbPath))
                {
                    loadAssembly = Assembly.LoadFrom(assmbPath);
                }
                else
                {
                    throw new FileNotFoundException($"Unable to locate dependency: {assmbPath}");
                }
            }

            return loadAssembly;
        }
    }
}